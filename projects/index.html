<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Aplicaci√≥n educativa para practicar matem√°ticas - Funciona offline">
    <meta name="theme-color" content="#8B5CF6">
    <title>Matem√°ticas Divertidas - PWA Educativa</title>
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" type="image/png" href="./icon.png">
    <link rel="apple-touch-icon" href="./icon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to bottom right, #3B82F6, #8B5CF6, #EC4899);
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .bounce {
            animation: bounce 0.5s ease-in-out;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div style="text-align: center; color: white;">
                <div style="font-size: 48px; margin-bottom: 16px;">üßÆ</div>
                <div style="font-size: 24px; font-weight: bold;">Cargando...</div>
            </div>
        </div>
    </div>
    
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Service Worker registrado:', reg))
                    .catch(err => console.log('Error al registrar SW:', err));
            });
        }

        // Math PWA Application
        let score = 0;
        let streak = 0;
        let bestStreak = 0;
        let totalAnswered = 0;
        let currentProblem = null;
        let difficulty = 'easy';

        function init() {
            document.getElementById('root').innerHTML = `
                <div style="min-height: 100vh; background: linear-gradient(to bottom right, #3B82F6, #8B5CF6, #EC4899); padding: 16px;">
                    <div style="max-width: 672px; margin: 0 auto;">
                        <div style="background: white; border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); padding: 24px; margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; flex-wrap: wrap; gap: 12px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <span style="font-size: 40px;">üß†</span>
                                    <h1 style="font-size: 28px; font-weight: bold; color: #1F2937; margin: 0;">Matem√°ticas Divertidas</h1>
                                </div>
                                <button onclick="resetGame()" style="padding: 8px; background: transparent; border: none; cursor: pointer; border-radius: 9999px; transition: all 0.2s; font-size: 24px;" onmouseover="this.style.background='#F3F4F6'" onmouseout="this.style.background='transparent'" title="Reiniciar">
                                    üîÑ
                                </button>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px;">
                                <div style="background: linear-gradient(to bottom right, #FEF3C7, #FDE68A); padding: 16px; border-radius: 12px;">
                                    <div style="font-size: 24px; font-weight: bold; color: #92400E;" id="score">0</div>
                                    <div style="font-size: 14px; color: #B45309;">Puntos</div>
                                </div>
                                <div style="background: linear-gradient(to bottom right, #D1FAE5, #A7F3D0); padding: 16px; border-radius: 12px;">
                                    <div style="font-size: 24px; font-weight: bold; color: #065F46; display: flex; align-items: center; gap: 4px;">
                                        <span id="streak">0</span> ‚≠ê
                                    </div>
                                    <div style="font-size: 14px; color: #047857;">Racha</div>
                                </div>
                                <div style="background: linear-gradient(to bottom right, #E9D5FF, #D8B4FE); padding: 16px; border-radius: 12px;">
                                    <div style="font-size: 24px; font-weight: bold; color: #6B21A8; display: flex; align-items: center; gap: 4px;">
                                        <span id="bestStreak">0</span> üèÜ
                                    </div>
                                    <div style="font-size: 14px; color: #7C3AED;">Mejor Racha</div>
                                </div>
                                <div style="background: linear-gradient(to bottom right, #DBEAFE, #BFDBFE); padding: 16px; border-radius: 12px;">
                                    <div style="font-size: 24px; font-weight: bold; color: #1E40AF;" id="accuracy">0%</div>
                                    <div style="font-size: 14px; color: #2563EB;">Precisi√≥n</div>
                                </div>
                            </div>
                        </div>

                        <div style="background: white; border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); padding: 24px; margin-bottom: 16px;">
                            <div style="font-size: 14px; font-weight: 600; color: #4B5563; margin-bottom: 12px;">Nivel de Dificultad:</div>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button onclick="setDifficulty('easy')" id="btn-easy" style="flex: 1; min-width: 100px; padding: 12px 16px; border-radius: 12px; font-weight: 600; border: none; cursor: pointer; transition: all 0.2s;">üü¢ F√°cil</button>
                                <button onclick="setDifficulty('medium')" id="btn-medium" style="flex: 1; min-width: 100px; padding: 12px 16px; border-radius: 12px; font-weight: 600; border: none; cursor: pointer; transition: all 0.2s;">üü° Medio</button>
                                <button onclick="setDifficulty('hard')" id="btn-hard" style="flex: 1; min-width: 100px; padding: 12px 16px; border-radius: 12px; font-weight: 600; border: none; cursor: pointer; transition: all 0.2s;">üî¥ Dif√≠cil</button>
                            </div>
                        </div>

                        <div style="background: white; border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); padding: 32px;" id="problemCard"></div>

                        <div style="text-align: center; margin-top: 24px; color: white; font-size: 14px;">
                            <p style="margin: 0;">üí° Practica operaciones matem√°ticas b√°sicas</p>
                            <p style="margin: 8px 0 0 0;">Funciona offline ¬∑ Instala como PWA</p>
                        </div>
                    </div>
                </div>
            `;
            
            updateDifficultyButtons();
            generateProblem();
        }

        function setDifficulty(level) {
            difficulty = level;
            updateDifficultyButtons();
            generateProblem();
        }

        function updateDifficultyButtons() {
            ['easy', 'medium', 'hard'].forEach(level => {
                const btn = document.getElementById('btn-' + level);
                if (btn) {
                    if (difficulty === level) {
                        btn.style.background = 'linear-gradient(to right, #9333EA, #EC4899)';
                        btn.style.color = 'white';
                        btn.style.boxShadow = '0 10px 15px -3px rgba(0,0,0,0.1)';
                    } else {
                        btn.style.background = '#F3F4F6';
                        btn.style.color = '#4B5563';
                        btn.style.boxShadow = 'none';
                    }
                }
            });
        }

        function generateProblem() {
            const maxNum = difficulty === 'easy' ? 10 : difficulty === 'medium' ? 50 : 100;
            const operators = ['+', '-', '√ó'];
            if (difficulty !== 'easy') operators.push('√∑');
            
            const operator = operators[Math.floor(Math.random() * operators.length)];
            let num1, num2, answer;
            
            if (operator === '√∑') {
                num2 = Math.floor(Math.random() * 10) + 1;
                answer = Math.floor(Math.random() * (maxNum / num2)) + 1;
                num1 = num2 * answer;
            } else {
                num1 = Math.floor(Math.random() * maxNum) + 1;
                num2 = Math.floor(Math.random() * maxNum) + 1;
                
                if (operator === '+') answer = num1 + num2;
                else if (operator === '-') {
                    if (num2 > num1) [num1, num2] = [num2, num1];
                    answer = num1 - num2;
                } else if (operator === '√ó') answer = num1 * num2;
            }
            
            currentProblem = { num1, num2, operator, answer };
            renderProblem();
        }

        function renderProblem() {
            const operatorSymbol = currentProblem.operator === '√ó' ? '‚úï' : currentProblem.operator;
            const card = document.getElementById('problemCard');
            if (card) {
                card.innerHTML = `
                    <div style="text-align: center; margin-bottom: 32px;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 24px; margin-bottom: 32px; flex-wrap: wrap;">
                            <div style="font-size: 48px; font-weight: bold; color: #1F2937;">${currentProblem.num1}</div>
                            <div style="font-size: 48px; color: #8B5CF6;">${operatorSymbol}</div>
                            <div style="font-size: 48px; font-weight: bold; color: #1F2937;">${currentProblem.num2}</div>
                            <div style="font-size: 48px; font-weight: bold; color: #9CA3AF;">=</div>
                            <div style="font-size: 48px; font-weight: bold; color: #8B5CF6;">?</div>
                        </div>
                        
                        <input type="number" id="answerInput" placeholder="?" style="width: 100%; max-width: 320px; font-size: 32px; font-weight: bold; text-align: center; padding: 16px; border: 4px solid #D8B4FE; border-radius: 12px; outline: none; transition: all 0.2s;" onfocus="this.style.borderColor='#8B5CF6'" onblur="this.style.borderColor='#D8B4FE'" onkeypress="if(event.key==='Enter') checkAnswer()">
                    </div>

                    <button onclick="checkAnswer()" id="checkBtn" style="width: 100%; padding: 16px; background: linear-gradient(to right, #9333EA, #EC4899); color: white; font-size: 18px; font-weight: bold; border-radius: 12px; border: none; cursor: pointer; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        Comprobar Respuesta
                    </button>
                    <div id="feedback"></div>
                `;
                const input = document.getElementById('answerInput');
                if (input) input.focus();
            }
        }

        function checkAnswer() {
            const input = document.getElementById('answerInput');
            if (!input) return;
            
            const userAnswer = parseInt(input.value);
            if (isNaN(userAnswer)) return;
            
            const isCorrect = userAnswer === currentProblem.answer;
            totalAnswered++;
            
            const feedback = document.getElementById('feedback');
            if (!feedback) return;
            
            if (isCorrect) {
                score += 10;
                streak++;
                if (streak > bestStreak) bestStreak = streak;
                
                feedback.innerHTML = `
                    <div class="bounce" style="background: #D1FAE5; border: 4px solid #10B981; border-radius: 12px; padding: 24px; text-align: center; margin-top: 16px;">
                        <div style="font-size: 64px; margin-bottom: 8px;">‚úÖ</div>
                        <div style="font-size: 24px; font-weight: bold; color: #065F46;">¬°Correcto! üéâ</div>
                        <div style="color: #047857; margin-top: 8px;">+10 puntos</div>
                    </div>
                `;
                
                setTimeout(() => generateProblem(), 1500);
            } else {
                streak = 0;
                feedback.innerHTML = `
                    <div style="background: #FEE2E2; border: 4px solid #EF4444; border-radius: 12px; padding: 24px; text-align: center; margin-top: 16px;">
                        <div style="font-size: 64px; margin-bottom: 8px;">‚ùå</div>
                        <div style="font-size: 24px; font-weight: bold; color: #991B1B;">Incorrecto</div>
                        <div style="color: #DC2626; margin-top: 8px;">La respuesta correcta es: <span style="font-weight: bold;">${currentProblem.answer}</span></div>
                    </div>
                `;
                
                setTimeout(() => {
                    feedback.innerHTML = '';
                    input.value = '';
                    input.focus();
                }, 2000);
            }
            
            updateStats();
        }

        function updateStats() {
            const scoreEl = document.getElementById('score');
            const streakEl = document.getElementById('streak');
            const bestStreakEl = document.getElementById('bestStreak');
            const accuracyEl = document.getElementById('accuracy');
            
            if (scoreEl) scoreEl.textContent = score;
            if (streakEl) streakEl.textContent = streak;
            if (bestStreakEl) bestStreakEl.textContent = bestStreak;
            if (accuracyEl) {
                const accuracy = totalAnswered > 0 ? Math.round((score / (totalAnswered * 10)) * 100) : 0;
                accuracyEl.textContent = accuracy + '%';
            }
        }

        function resetGame() {
            score = 0;
            streak = 0;
            totalAnswered = 0;
            updateStats();
            generateProblem();
        }

        // Initialize app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
